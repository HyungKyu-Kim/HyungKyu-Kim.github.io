<!DOCTYPE html>
<html lang='en'>
  <head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Guidewire Navigation based on Reinforcement Learning | Hyungkyu Kim</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Guidewire Navigation based on Reinforcement Learning" />
<meta name="author" content="Hyungkyu Kim" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This system places a stent in the target lesion of the coronary artery via a controlling manipulator made by Asan Medical Center. It is the world’s first autonomous PCI robot system. My team developed reinforcement learning-based control software. This project was awarded first place at Johnson &amp; Johnson QuickFire Challenge." />
<meta property="og:description" content="This system places a stent in the target lesion of the coronary artery via a controlling manipulator made by Asan Medical Center. It is the world’s first autonomous PCI robot system. My team developed reinforcement learning-based control software. This project was awarded first place at Johnson &amp; Johnson QuickFire Challenge." />
<link rel="canonical" href="http://localhost:4000/portfolio/medipixel/guidewire_navigation_based_on_reinforcement_learning" />
<meta property="og:url" content="http://localhost:4000/portfolio/medipixel/guidewire_navigation_based_on_reinforcement_learning" />
<meta property="og:site_name" content="Hyungkyu Kim" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-04-14T00:00:00+09:00" />
<script type="application/ld+json">
{"headline":"Guidewire Navigation based on Reinforcement Learning","dateModified":"2019-04-14T00:00:00+09:00","url":"http://localhost:4000/portfolio/medipixel/guidewire_navigation_based_on_reinforcement_learning","datePublished":"2019-04-14T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/portfolio/medipixel/guidewire_navigation_based_on_reinforcement_learning"},"author":{"@type":"Person","name":"Hyungkyu Kim"},"description":"This system places a stent in the target lesion of the coronary artery via a controlling manipulator made by Asan Medical Center. It is the world’s first autonomous PCI robot system. My team developed reinforcement learning-based control software. This project was awarded first place at Johnson &amp; Johnson QuickFire Challenge.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel='stylesheet' href='/assets/main.css'>
  <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Hyungkyu Kim" />
  
  <script async src='https://www.googletagmanager.com/gtag/js?id=UA-142400702-1'></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-142400702-1');
  </script>


</head>

  <body>
    <div class='layout'>
      <header class='header'>
  <nav class='header__nav'>
    
      
        <a class='header__nav__item' href='/'>Hyungkyu Kim</a>
      
    
      
        <a class='header__nav__item--selected' href='/portfolio'>Portfolio</a>
      
    
  </nav>
  <hr width=100% border-color=#EBEBEB size=1>
</header>
      <main class='main'>
        <article class='post'>
  <div class="posts__navigation">
    <a href="/portfolio"> Portfolio </a> &nbsp; > &nbsp; <a href="/portfolio#Medipixel"> Medipixel </a> &nbsp; > &nbsp; Guidewire Navigation based on Reinforcement Learning
  </div>
  <br/>
  <div>
  
    
      <img src="/images/medipixel/logo_medipixel.png" width="100px" style="margin-bottom:35px">
      
  </div>
  <h1>Guidewire Navigation based on Reinforcement Learning</h1>
  <p>This system places a stent in the target lesion of the coronary artery via a controlling manipulator made by <a href="http://eng.amc.seoul.kr/gb/lang/main.do">Asan Medical Center</a>. 
It is the world’s first autonomous <a href="https://en.wikipedia.org/wiki/Percutaneous_coronary_intervention">PCI</a> robot system. 
My team developed reinforcement learning-based control software. 
This project was awarded first place at <a href="https://jlabs.jnjinnovation.com/quickfire-challenges/seoul-innovation-quickfire-challenge-robotics-digital-surgery">Johnson &amp; Johnson QuickFire Challenge</a>.</p>

<!--break-->

<h4 id="my-role">My Role</h4>
<p>Development Team Leader</p>
<ul>
  <li>Design overall system architecture</li>
  <li>Design data flow in system</li>
  <li>Design an experiment process</li>
  <li>Establish experiment environment</li>
  <li>Implement device communication(manipulator, camera) module</li>
  <li>Implement reinforcement learning environment module</li>
</ul>

<hr />
<h4 id="project-detail">Project Detail</h4>

<!-- Feel free to change the width and height to your desired video size. -->

<div class="embed-container">
  <iframe src="https://www.youtube.com/embed/1imlCMfr4mI" width="700" height="480" frameborder="0" allowfullscreen="">
  </iframe>
</div>

<p><br />
Each year, Cardiovascular disease causes a large portion of annual death around the world. 
A <a href="https://www.who.int/news-room/fact-sheets/detail/the-top-10-causes-of-death">WHO announcement</a> shows that ischaemic heart disease was the world’s biggest killer in 2016 and one of the most general treatments for ischaemic heart disease is <a href="https://en.wikipedia.org/wiki/Percutaneous_coronary_intervention">Percutaneous Coronary Intervention</a>. 
However, <strong>traditional PCI has several drawbacks:</strong></p>
<ul>
  <li>Large gap of proficiency and difficult transfer of an advanced skill</li>
  <li>Exposure to harmful radiation generated from angiography</li>
  <li>Long time required (about 1 hour)</li>
</ul>

<p>To overcome these challenges, Medipixel has been collaborating with <a href="http://eng.amc.seoul.kr/gb/lang/main.do">Asan Medical Center</a> to develop <strong>the world’s first autonomous PCI robot system</strong>. 
This system autonomously navigates guide wire to the target lesion, which means it transform an atypical atypical procedure requiring personal skill and experience to typical procedure.
The <strong>“Standardization of Procedure”</strong> process has advantages such as:</p>
<ul>
  <li>Reducing skill gap between an experienced doctor and a novice doctor</li>
  <li>Reducing exposure time to radiation</li>
  <li>Enabling workers to do other tasks</li>
  <li>Reducing time</li>
</ul>

<figure>
  <img src="/images/medipixel/profile_biorobot_animal_ex.png" />
  <figcaption>Animal test observation - COPYRIGHT© 2017 Medipixel. All Rights Reserved.</figcaption>
</figure>

<h5 id="challenges">Challenges</h5>
<p>For a successful PCI procedure, it is necessary to quantify the abstract and complex factors, such as the doctor’s experience and medical knowledge, into proper numerical values in the system. 
When performing this task, we considered the following issues:</p>

<div class="container">
    <div class="image">
        <img src="/images/medipixel/profile_biorobot_medicine.png" />
    </div>
    <div class="text">
        <h6>Safety</h6>
        <br />
        <ul>
            <li>
                There is a possibility that even an unexpected movement of the guidewire can cause a fatal situation in the coronary artery
            </li>
            <li>
                Doctors must be able to monitor and intervene in an emergency situation 
            </li>
            <li>
                Intervention of doctor should be quick
            </li>
        </ul>
    </div>
</div>

<div class="container"> 
    <div class="image">
        <img src="/images/medipixel/profile_biorobot_robotics.png" />
    </div>
    <div class="text">
        <h6>Nonlinearity of manipulation</h6>
        <br />
        <ul>
            <li>
                Friction and twist of wire can trigger a difference between control input and output
            </li>
            <li>
                Manipulation error in a real environment (e.g. wire slip) is another issue in terms of error management
            </li>
            <li>
                Control of the flexible body is a traditionally hard problem 
            </li>
        </ul>
    </div>
</div>

<div class="container"> 
    <div class="image">
        <img src="/images/medipixel/profile_biorobot_cag.gif" />
    </div>
    <div class="text">
        <h6>Complexity of environment</h6>
        <br />
        <ul>
            <li>
                Coronary arteries have a complex physical structure including dynamic status changes like blood flow and heartbeat
            </li>
            <li>
                It is possible that external factors (e.g. condition of patient) cause abnormal environments  
            </li>
        </ul>
    </div>
</div>

<h5 id="required-technologies">Required Technologies</h5>
<p>To undertake the complex project, my team prepared various technologies including medicine, robotics and reinforcement learning.</p>

<ul>
  <li>To maintain safety, we needed to comprehend the necessary medical knowledge related to PCI</li>
  <li>To achieve robust control, my team surveyed domains such as Robotics and Elastic Rod</li>
  <li>To improve system accuracy, we studied Reinforcement Learning(RL) and Computer Vision Algorithm</li>
</ul>

<figure>
  <img src="/images/medipixel/profile_biorobot_tech.png" width="95%" />
</figure>

<h6 id="why-reinforcement-learning">Why Reinforcement Learning?</h6>
<p>Our environment was so complex that we did not have high confidence in the traditional control method of robotics.
Since most of the traditional algorithms are static, they have difficulty handling dynamic environments.
Therefore, to accomplish the task, we used an “interaction algorithm” with the dynamic environment.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_mdp.gif" width="60%" />
</figure>

<h5 id="main-tasks">Main Tasks</h5>
<h6 id="planning">Planning</h6>
<p>To solve such a complex problem, we needed a step-by-step approach.
Simplifying the problem, we started at the lowest dimension.
First, I set up project stages as follows:</p>
<blockquote>
  <p>2D → 3D → 3D with vibration → Animal → Clinical environment</p>
</blockquote>

<h6 id="initiation">Initiation</h6>
<p>My role in this project was to decide the direction of development as a development team leader.
I divided the complicated main task into several sub-tasks to operationalize the plan.
I performed below tasks in each stage:</p>

<ol>
  <li>Pre-research: To acquire knowledge to build the system</li>
  <li>Set-up: To establish all experiment environments</li>
  <li>Design: To design overall system architecture</li>
  <li>Implementation: To implement the environment module in RL framework and integrate all modules</li>
</ol>

<h5 id="pre-research">Pre-research</h5>

<h6 id="system-framework">System Framework</h6>
<p>I researched existing systems for RL control in real environments published in various sources (e.g. <a href="https://ieeexplore.ieee.org/xpl/mostRecentIssue.jsp?punumber=8449910">ICRA</a>, <a href="https://www.nema.org/pages/default.aspx">NEMA</a> and <a href="https://arxiv.org/">Arxiv</a>). 
<a href="https://arxiv.org/abs/1803.07067v1">Setting up a Reinforcement Learning Task with a Real-World Robot</a> was one of the most helpful experimental result in terms of understanding 1) the relationship between System delays and System performance, 2) training results depending on action space, and 3) the hierarchy of systems in the real world</p>

<h6 id="medical-knowledge">Medical Knowledge</h6>
<p>We conducted interviews with doctors and researchers who have dealt with coronary artery disease. 
Also, we observed the PCI procedure several times and studied coronary arteries. 
Through this process, we learned about 1) the procedure of PCI, 2) case studies by patient, 3) usage of equipment, 4) terms/abbreviations and 5) procedure time</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_procedure.png" />
</figure>

<h5 id="set-up">Set-up</h5>

<h6 id="establishment-of-experiment-plan">Establishment of Experiment Plan</h6>
<p>The first environment was a two dimensional blood vessel model.
I selected equipment for the system and drew a rough sketch of the experiment environment. 
Final expected environment design output is below.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_2d3denv.png" width="90%" />
</figure>

<h6 id="installation-of-darkroom">Installation of Darkroom</h6>
<p>Vision was the most important input data process for this system.
Since vision is sensitive to changes in illumination, I had to exclude natural light from experiment environment and darkroom was the best solution. 
For this task, I was in charge of purchasing and installing all equipment for the darkroom.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_experiment_env.png" width="90%" />
</figure>

<h6 id="comparison-of-cameras-by-latency">Comparison of Cameras by Latency</h6>
<p>Latency is one of the most significant factors for system performance. 
As a large proportion of latency depended on the camera, I selected a camera model carefully. 
As seen in the figure below, I conducted latency tests and compared scalability, compatibility, resolution, and latency of the various camera models.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_realsense_test.gif" width="60%" />
</figure>

<h5 id="design-principles">Design Principles</h5>

<h6 id="modularity">Modularity</h6>
<p>Since this system is capable of having diverse environmental conditions like manipulator and external sensor devices, 
I looked for a way to minimize the number of additional tasks when subsystems or peripherals were changed.
I suggested a form on separating the system into submodules by role and made a hierarchy among the submodules.</p>

<h6 id="scalability">Scalability</h6>
<p>As mentioned above, we planned an environment transition step-by-step. 
Thus, I had to enable smooth conversion among heterogeneous environments such as 2D, 3D, animal, and clinic. 
Also, as we needed repetitive experiments for improving system performance like reward shaping, various settings for experiments had to be managed conveniently.
I achieved this via an abstract and inheritance structure.</p>

<h6 id="compatibility">Compatibility</h6>
<p>The RL algorithm is necessary to be verified based on a unit test. 
We used the <a href="https://gym.openai.com/envs/#atari">Atari gym</a> environment for testing. 
I also considered standard communication protocol connecting with heterogeneous external devices.
For this reason, I designed the system using de facto standard systems such as <a href="https://gym.openai.com/">openai-gym</a> and <a href="http://www.ros.org/">ROS</a>.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_arch.png" />
  <figcaption></figcaption>
</figure>

<h5 id="implementation-issues">Implementation Issues</h5>

<h6 id="handling-nonlinearity">Handling Nonlinearity</h6>
<p>There were physical errors during manipulation caused by motor rotation as many general control systems under physical world have. 
In the coronary artery environment, this kind of error had a worse effect because it requires handling an exquisite unit of space and time. 
I approached this problem in a heuristic way and tried to define error tolerance thresholds because there is no perfect solution for this issue. 
Through a trial and error process, my team found that using a very small fixed step command (about 0.05mm) guaranteed that guidewire would be less affected by this problem and able to reach the correct position.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_slip.png" width="95%" />
</figure>

<h6 id="elaborate-data-flow-of-inter-module-communication">Elaborate Data Flow of Inter-module Communication</h6>
<p>To set the proper shape and size of data, there were several trial and error attempts. 
As the shape of data required in each module was different, I pondered the computational cost of reshaping the data while one module was transferring data to next module. 
Also, because RL agent utilized experience replay, limitation of memory size for replay buffer was a big issue. 
Thus, the size of state in RL had to be defined properly.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_data.png" width="80%" />
</figure>

<h6 id="synchronization-between-rl-agent-and-manipulator">Synchronization Between RL agent and Manipulator</h6>
<p>RL agent needs to obtain the necessary data at once for decision making in each time step. 
As a manipulator operates in asynchronous method, I had to choose the module waiting to collect data from the manipulator for synchronization. 
I implemented a communication module and put this module in charge of that task.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_sync.png" width="80%" />
</figure>

<h6 id="reduction-of-system-latency">Reduction of System Latency</h6>
<p>Reactivity of the system is one of the most critical factors in overall system performance since agile situational awareness and countermeasures are essential in PCI procedures. 
Thus, it was imperative to minimize latency on each module because the summation of delayed time took a huge proportion of reactivity. 
Especially, total latency largely depends on a acquisition time of the camera image and vision preprocessing time.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_latency.png" width="95%" />
</figure>

<h6 id="strict-exception-handling">Strict Exception Handling</h6>
<p>It was essential to handle and recover errors that cause harmful results because this system was trained in a real environment. 
I handled many abnormal situations like a twisted guidewire and path deviation from excessive manipulation. 
Communication manipulator exception was another serious situation because it could lead to the system procedure being halted.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_twist.gif" width="60%" />
</figure>

<h5 id="experiment">Experiment</h5>

<h6 id="rl-algorithms">RL Algorithms</h6>
<p>My team implemented and ran numerous experiments with RL algorithms to improve system performance.</p>

<ul>
  <li>Value based algorithms (<a href="https://arxiv.org/abs/1710.02298">Rainbow dqn</a>, <a href="https://arxiv.org/abs/1707.06887">C51</a>, <a href="https://arxiv.org/abs/1806.06923">IQN</a>)</li>
  <li>Demonstration algorithms (<a href="https://arxiv.org/abs/1704.03732">Deep Q-learning from Demonstrations</a>)</li>
  <li>Reward Shaping</li>
  <li>Data fusion Execution Timing (Early fusion, Late fusion)</li>
  <li>Additional (<a href="https://arxiv.org/abs/1707.01495">Hindsight Experience Replay</a>)</li>
</ul>

<h6 id="setup">Setup</h6>
<p>In the guidewire navigation problem, selection of the correct vessel branch is a main issue.
Thus, we focused on verifying it and designing the experiment process.
The settiing is below:</p>

<ul>
  <li>Max step is 700</li>
  <li>Rewards are imposed by operating time and path correctness</li>
  <li>Success of episode is to reach the target point within the max step</li>
  <li>Goal positions are as below</li>
</ul>

<figure>
  <img src="/images/medipixel/profile_biorobot_goals.png" width="60%" />
</figure>

<h5 id="conclusion">Conclusion</h5>
<p>The guidewire successfully achieved our basic goals in the 2D blood vessel. 
Our navigation system successfully reached the goal position about 95% of the time.
Currently, my team and  researchers in AMC are writing a research paper targeting <a href="https://www.crf.org/tct">TCT</a>, a top tier medical conference.</p>

<h6 id="success-rate">Success rate</h6>
<p>The more training that is carried out, the nearer our success rate moves to 1.0.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_successrate.png" />
</figure>

<h6 id="time-spent">Time spent</h6>
<p>In early stage training, the wire moved forward regardless of success.
Thus, episode time spent on early stage was short.
However, after evolving period (400~600 episode step), the system had a high success rate and takes short time similar to time spent on the early stage.</p>

<figure>
  <img src="/images/medipixel/profile_biorobot_timespent.png" />
</figure>

<h5 id="further">Further</h5>

<h6 id="possibility-to-transfer-other-domain">Possibility to Transfer Other Domain</h6>

<p>Because the skill-set includes controlling flexible medium and setting RL environment for control systems, we can utilize it in other fields.
We are meeting with people from other fields to find applications of our system to their fields.</p>

<table>
  <thead>
    <tr>
      <th>Search system</th>
      <th>Pipeline integrity inspection</th>
      <th>Catheter procedure automation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><img src="/images/medipixel/profile_biorobot_newdomain0.png" />Search system used to locate people in a collapsed building by manipulating wire camera</td>
      <td><img src="/images/medipixel/profile_biorobot_newdomain1.png" />Pipeline integrity inspection in a construction site</td>
      <td><img src="/images/medipixel/profile_biorobot_newdomain2.png" />Automation of other procedure through wire and catheter</td>
    </tr>
  </tbody>
</table>

<h6 id="next-plan">Next Plan</h6>
<p>We expect to advance to a new experiment project in a 3D environment in the second half of 2019.</p>
<figure>
  <img src="/images/medipixel/profile_biorobot_3denv.png" width="60%" />
</figure>

</article>

      </main>
      <footer class='footer'>
  <ul class='footer__list'>
    
      
        <li class='footer__item'>
          <a href='mailto:hkkxkk@gmail.com'>Hyungkyu Kim</a>
        </li>
      
    

    
      <li class='footer__item'>
        <a href='https://github.com/Hyungkyu-Kim' title='github'>
          <svg class='icon'><use href='/assets/icons/github.svg#github' xlink:href='/assets/icons/github.svg#github'></use>
</svg>

        </a>
      </li>
    

    
      <li class='footer__item'>
        <a href='https://www.linkedin.com/in/hyungkyu-kim-9915b8151' title='linkedin'>
          <svg class='icon'><use href='/assets/icons/linkedin.svg#linkedin' xlink:href='/assets/icons/linkedin.svg#linkedin'></use>
</svg>

        </a>
      </li>
    

    

    

    
  </ul>
</footer>

    </div>
  </body>
</html>
